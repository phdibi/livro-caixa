import{r as d,j as e}from"./index-Dj2qBV3V.js";const B="1.0",D=({isOpen:k,onClose:l,transactions:u,accounts:g,recurringTransactions:m,onRestore:j})=>{var p;const[b,h]=d.useState(!1),[f,o]=d.useState(null),[t,c]=d.useState(null),x=d.useRef(null);if(!k)return null;const v=()=>{const i={version:B,exportDate:new Date().toISOString(),transactions:u,accounts:g,recurringTransactions:m},r=new Blob([JSON.stringify(i,null,2)],{type:"application/json"}),a=URL.createObjectURL(r),s=document.createElement("a");s.href=a,s.download=`livro_caixa_backup_${new Date().toISOString().slice(0,10)}.json`,s.click(),URL.revokeObjectURL(a)},N=i=>{var s;const r=(s=i.target.files)==null?void 0:s[0];if(!r)return;o(null),c(null);const a=new FileReader;a.onload=S=>{var y;try{const n=JSON.parse((y=S.target)==null?void 0:y.result);if(!n.version||!n.transactions||!n.accounts)throw new Error("Arquivo de backup inválido ou corrompido.");c(n)}catch(n){o(n.message||"Erro ao ler arquivo de backup.")}},a.readAsText(r)},w=async()=>{var r;if(!t)return;const i=`ATENÇÃO: Isso irá SUBSTITUIR todos os seus dados atuais por:
    
- ${t.transactions.length} transações
- ${t.accounts.length} contas
- ${((r=t.recurringTransactions)==null?void 0:r.length)||0} contas fixas

Backup de: ${new Date(t.exportDate).toLocaleString("pt-BR")}

Tem certeza que deseja continuar?`;if(window.confirm(i)){h(!0);try{await j({transactions:t.transactions,accounts:t.accounts,recurringTransactions:t.recurringTransactions||[]}),alert("Dados restaurados com sucesso!"),l()}catch(a){o(a.message||"Erro ao restaurar dados.")}finally{h(!1)}}},R=()=>{c(null),o(null),x.current&&(x.current.value="")};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-md p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Backup e Restauração"}),e.jsx("button",{onClick:l,className:"text-gray-400 hover:text-gray-600 text-2xl",children:"×"})]}),e.jsxs("div",{className:"mb-6 pb-6 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2",children:"Exportar Backup"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-3",children:"Salve uma cópia de todos os seus dados em um arquivo JSON."}),e.jsxs("div",{className:"text-xs text-gray-600 dark:text-gray-400 mb-3",children:[e.jsxs("div",{children:["• ",u.length," transações"]}),e.jsxs("div",{children:["• ",g.length," contas"]}),e.jsxs("div",{children:["• ",m.length," contas fixas"]})]}),e.jsx("button",{onClick:v,className:"w-full px-4 py-2 text-sm font-medium text-white bg-green-600 rounded-md hover:bg-green-700",children:"Baixar Backup"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2",children:"Restaurar Backup"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-3",children:"⚠️ Isso substituirá TODOS os dados atuais pelos do backup."}),f&&e.jsx("div",{className:"mb-3 p-2 bg-red-100 dark:bg-red-900/50 text-red-700 dark:text-red-300 text-xs rounded",children:f}),t?e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900/50 p-3 rounded-md",children:[e.jsx("p",{className:"text-xs font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Prévia do Backup:"}),e.jsxs("div",{className:"text-xs text-gray-600 dark:text-gray-400 mb-3",children:[e.jsxs("div",{children:["Data: ",new Date(t.exportDate).toLocaleString("pt-BR")]}),e.jsxs("div",{children:["• ",t.transactions.length," transações"]}),e.jsxs("div",{children:["• ",t.accounts.length," contas"]}),e.jsxs("div",{children:["• ",((p=t.recurringTransactions)==null?void 0:p.length)||0," contas fixas"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:R,className:"flex-1 px-3 py-2 text-xs font-medium text-gray-700 dark:text-gray-300 bg-gray-200 dark:bg-gray-700 rounded-md hover:bg-gray-300",children:"Cancelar"}),e.jsx("button",{onClick:w,disabled:b,className:"flex-1 px-3 py-2 text-xs font-medium text-white bg-red-600 rounded-md hover:bg-red-700 disabled:opacity-50",children:b?"Restaurando...":"Confirmar Restauração"})]})]}):e.jsx("div",{children:e.jsx("input",{ref:x,type:"file",accept:".json",onChange:N,className:`w-full text-sm text-gray-500 dark:text-gray-400
                  file:mr-4 file:py-2 file:px-4
                  file:rounded-md file:border-0
                  file:text-sm file:font-medium
                  file:bg-indigo-50 file:text-indigo-700
                  dark:file:bg-indigo-900 dark:file:text-indigo-200
                  hover:file:bg-indigo-100
                  cursor-pointer`})})]}),e.jsx("div",{className:"mt-6 pt-4 border-t border-gray-200 dark:border-gray-700",children:e.jsx("button",{onClick:l,className:"w-full px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 rounded-md hover:bg-gray-200",children:"Fechar"})})]})})};export{D as default};
