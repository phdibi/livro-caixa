import{r as m,I as u,R as h,T as M,b as z,g as j,j as e,p as re,c as se}from"./index-DkBehhdW.js";const O=()=>z(new Date),de=({isOpen:D,onClose:V,onSave:U,transactionToEdit:l,accounts:x,transactions:_})=>{const p=m.useMemo(()=>({number:x.length>0?x[0].number:0,name:x.length>0?x[0].name:""}),[x]),q=m.useCallback(()=>({date:O(),type:M.SAIDA,accountNumber:p.number,accountName:p.name,description:"",quantity:1,unitValue:0,amount:0,payee:"",paymentMethod:"pix",notes:"",receiptStatus:h.NONE,irCategory:u.NAO_DEDUTIVEL,irNotes:"",isContaTiti:!1}),[p]),v=m.useCallback(()=>({id:j(),accountNumber:p.number,accountName:p.name,description:"",quantity:1,unitValue:0,amount:0}),[p]),[n,b]=m.useState(q()),[f,I]=m.useState(1),[E,A]=m.useState(O()),[Q,W]=m.useState("single"),[k,S]=m.useState(!1),[R,N]=m.useState([v()]),T=!!(l!=null&&l.seriesId);if(m.useEffect(()=>{if(D)if(l){const t={...q(),...l};if(l.seriesId){const a=_.filter(r=>r.seriesId===l.seriesId);I(a.length||1);const g=[...a].sort((r,i)=>r.date.localeCompare(i.date))[0]??l;A(g.date)}else I(1),A(l.date);b(t);const s=l.items;s&&s.length>0?(S(!0),N(s.map(a=>({id:a.id||j(),accountNumber:a.accountNumber,accountName:a.accountName,description:a.description,quantity:a.quantity,unitValue:a.unitValue,amount:a.amount})))):(S(!1),N([v()]))}else{const t=q();b(t),I(1),A(t.date),W("single"),S(!1),N([v()])}},[D,l,_,x]),m.useEffect(()=>{var a;if(k)return;const t=n.quantity||0,s=n.unitValue||0;((a=document.activeElement)==null?void 0:a.getAttribute("name"))!=="amount"&&b(y=>({...y,amount:t*s}))},[n.quantity,n.unitValue,k]),!D)return null;const o=t=>{const{name:s,value:a}=t.target,y=t.target.checked;if(s==="isContaTiti"){b(r=>({...r,isContaTiti:y}));return}if(s==="accountNumber"){const r=parseInt(a,10),i=x.find(d=>d.number===r);b(d=>({...d,accountNumber:r,accountName:(i==null?void 0:i.name)||""}));return}if(s==="receiptStatus"){b(r=>({...r,receiptStatus:a}));return}if(s==="irCategory"){b(r=>({...r,irCategory:a}));return}let g=a;["amount","quantity","unitValue"].includes(s)&&(g=parseFloat(a)||0),b(r=>({...r,[s]:g}))},C=(t,s,a)=>{N(y=>y.map(g=>{if(g.id!==t)return g;const r={...g};switch(s){case"accountNumber":{const i=parseInt(a,10),d=x.find(c=>c.number===i);r.accountNumber=i,r.accountName=(d==null?void 0:d.name)||"";break}case"quantity":r.quantity=parseFloat(a)||0;break;case"unitValue":r.unitValue=parseFloat(a)||0;break;case"amount":r.amount=parseFloat(a)||0;break;case"description":r.description=String(a);break}return(s==="quantity"||s==="unitValue")&&(r.amount=r.quantity*r.unitValue),r}))},G=()=>N(t=>[...t,v()]),X=t=>N(s=>s.length===1?[v()]:s.filter(a=>a.id!==t)),J=t=>{if(t.preventDefault(),k&&!T){const a=R.filter(d=>d.description.trim()!==""||d.amount>0);if(a.length===0){alert("Adicione pelo menos um item na nota.");return}const y=j(),r=f>1&&E||n.date||O(),i=re(r);if(Number.isNaN(i.getTime())){alert("Data da 1ª parcela inválida. Verifique o campo de data do lançamento.");return}a.forEach(d=>{const c=Math.max(1,f),B=c>1?j():void 0,Y=typeof d.amount=="number"&&!isNaN(d.amount)?d.amount:(d.quantity||0)*(d.unitValue||0),L=Math.round(Y*100),H=c>0?Math.floor(L/c):L;let Z=L-H*c;for(let w=0;w<c;w++){const ee=se(i,w);let P=H;w===c-1&&(P+=Z);const ae=P/100,$={...n,id:j(),date:z(ee),accountNumber:d.accountNumber,accountName:d.accountName,description:c>1?`${d.description} (${w+1}/${c})`:d.description,quantity:d.quantity,unitValue:d.unitValue,amount:ae,invoiceId:y},te=c>1&&B?{...$,seriesId:B}:$;U({transaction:te,installmentsCount:1})}}),V();return}const s={...n,id:(l==null?void 0:l.id)||j(),date:n.date};U({transaction:s,updateScope:T?Q:void 0,installmentsCount:f,firstInstallmentDate:E}),V()},F=!T,K=R.reduce((t,s)=>t+s.amount,0);return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-start sm:items-center p-2 sm:p-4 overflow-y-auto",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-2xl p-4 sm:p-6 my-4 sm:my-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[l?"Editar":"Adicionar"," Lançamento"]}),e.jsxs("label",{className:"flex items-center text-xs sm:text-sm text-gray-700 dark:text-gray-300",children:[e.jsx("input",{type:"checkbox",checked:k,onChange:t=>S(t.target.checked&&F),disabled:!F,className:"mr-2"}),"Modo nota fiscal"]})]}),e.jsx("div",{className:"mb-4",children:e.jsxs("label",{className:"flex items-center text-sm font-medium text-amber-600 dark:text-amber-400",children:[e.jsx("input",{type:"checkbox",name:"isContaTiti",checked:!!n.isContaTiti,onChange:o,className:"mr-2 rounded border-gray-300 text-amber-600 shadow-sm focus:border-amber-300 focus:ring focus:ring-amber-200 focus:ring-opacity-50"}),"Conta Titi (Ocultar do fluxo/gráficos)"]})}),e.jsxs("form",{onSubmit:J,className:"space-y-4 max-h-[80vh] overflow-y-auto pr-1",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 dark:text-gray-300",children:"Data"}),e.jsx("input",{type:"date",name:"date",value:n.date,onChange:o,className:"mt-1 w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 dark:text-gray-300",children:"Tipo"}),e.jsxs("select",{name:"type",value:n.type,onChange:o,className:"mt-1 w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white",children:[e.jsx("option",{value:M.ENTRADA,children:"Entrada"}),e.jsx("option",{value:M.SAIDA,children:"Saída"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 dark:text-gray-300",children:"Fornecedor/Comprador"}),e.jsx("input",{type:"text",name:"payee",value:n.payee,onChange:o,placeholder:"Nome do fornecedor ou comprador",className:"mt-1 w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white"})]}),!k&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 dark:text-gray-300",children:"Conta"}),e.jsx("select",{name:"accountNumber",value:n.accountNumber,onChange:o,className:"mt-1 w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white",children:x.map(t=>e.jsxs("option",{value:t.number,children:[t.number," - ",t.name]},t.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 dark:text-gray-300",children:"Histórico"}),e.jsx("input",{type:"text",name:"description",value:n.description,onChange:o,className:"mt-1 w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white"})]})]}),k?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"border-2 border-amber-400 dark:border-amber-600 rounded-md p-3 bg-amber-50 dark:bg-amber-900/20 space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("p",{className:"text-xs font-semibold text-amber-700 dark:text-amber-300 uppercase flex items-center",children:[e.jsx("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Itens da Nota Fiscal"]}),e.jsxs("span",{className:"text-xs text-amber-600 dark:text-amber-400",children:["Total:"," ",e.jsx("strong",{children:K.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})})]})]}),R.map((t,s)=>e.jsxs("div",{className:"border rounded-md p-2 mb-2 bg-white dark:bg-gray-800",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("span",{className:"text-xs font-medium text-gray-500 dark:text-gray-400",children:["Item ",s+1]}),e.jsx("button",{type:"button",onClick:()=>X(t.id),className:"text-xs text-red-600 dark:text-red-400 hover:text-red-800",children:"Remover"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 mb-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-700 dark:text-gray-300",children:"Conta"}),e.jsx("select",{value:t.accountNumber,onChange:a=>C(t.id,"accountNumber",a.target.value),className:"mt-1 w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white text-sm",children:x.map(a=>e.jsxs("option",{value:a.number,children:[a.number," - ",a.name]},a.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-700 dark:text-gray-300",children:"Descrição do item"}),e.jsx("input",{type:"text",value:t.description,onChange:a=>C(t.id,"description",a.target.value),placeholder:"Ex: Ração, Medicamento...",className:"mt-1 w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white text-sm"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-700 dark:text-gray-300",children:"Qtde"}),e.jsx("input",{type:"number",step:"any",value:t.quantity,onChange:a=>C(t.id,"quantity",a.target.value),className:"mt-1 w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-700 dark:text-gray-300",children:"Valor unit."}),e.jsx("input",{type:"number",step:"any",value:t.unitValue,onChange:a=>C(t.id,"unitValue",a.target.value),className:"mt-1 w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-700 dark:text-gray-300",children:"Valor total"}),e.jsx("input",{type:"number",step:"any",value:t.amount,onChange:a=>C(t.id,"amount",a.target.value),className:"mt-1 w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white text-sm font-semibold"})]})]})]},t.id)),e.jsxs("button",{type:"button",onClick:G,className:"text-sm text-amber-700 dark:text-amber-400 hover:text-amber-900 flex items-center",children:[e.jsx("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Adicionar item"]})]})}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 dark:text-gray-300",children:"Qtde"}),e.jsx("input",{type:"number",name:"quantity",step:"any",value:n.quantity??1,onChange:o,className:"mt-1 w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 dark:text-gray-300",children:"Valor unit."}),e.jsx("input",{type:"number",name:"unitValue",step:"any",value:n.unitValue??0,onChange:o,className:"mt-1 w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 dark:text-gray-300",children:"Total"}),e.jsx("input",{type:"number",name:"amount",step:"0.01",value:n.amount,onChange:o,className:"mt-1 w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white font-semibold"})]})]})}),e.jsxs("div",{className:"border rounded-md p-3 bg-gray-50 dark:bg-gray-900/40 space-y-3",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-700 dark:text-gray-200 uppercase",children:"Imposto de Renda / Comprovante"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-700 dark:text-gray-300",children:"Situação do comprovante"}),e.jsxs("div",{className:"mt-1 space-y-1 text-xs",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"receiptStatus",value:h.NONE,checked:(n.receiptStatus??h.NONE)===h.NONE,onChange:o,className:"form-radio text-indigo-600"}),e.jsx("span",{className:"ml-2 text-gray-700 dark:text-gray-300",children:"Não tenho comprovante"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"receiptStatus",value:h.HAS_BUT_NOT_ATTACHED,checked:n.receiptStatus===h.HAS_BUT_NOT_ATTACHED,onChange:o,className:"form-radio text-indigo-600"}),e.jsx("span",{className:"ml-2 text-gray-700 dark:text-gray-300",children:"Tenho, mas ainda não anexei"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"receiptStatus",value:h.ATTACHED,checked:n.receiptStatus===h.ATTACHED,onChange:o,className:"form-radio text-indigo-600"}),e.jsx("span",{className:"ml-2 text-gray-700 dark:text-gray-300",children:"Comprovante anexado"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-700 dark:text-gray-300",children:"Categoria IR"}),e.jsxs("select",{name:"irCategory",value:n.irCategory??u.NAO_DEDUTIVEL,onChange:o,className:"mt-1 w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white text-xs",children:[e.jsx("option",{value:u.NAO_DEDUTIVEL,children:"Não dedutível / geral"}),e.jsx("option",{value:u.SAUDE,children:"Saúde (dedutível)"}),e.jsx("option",{value:u.EDUCACAO,children:"Educação (dedutível)"}),e.jsx("option",{value:u.LIVRO_CAIXA,children:"Livro caixa (autônomo)"}),e.jsx("option",{value:u.CARNE_LEAO,children:"Carnê Leão (autônomo)"}),e.jsx("option",{value:u.ALUGUEL,children:"Aluguel"}),e.jsx("option",{value:u.BEM_DIREITO,children:"Bens e direitos"}),e.jsx("option",{value:u.ATIVIDADE_RURAL,children:"Atividade Rural"}),e.jsx("option",{value:u.OUTRA,children:"Outros"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-700 dark:text-gray-300",children:"Observações para IR (opcional)"}),e.jsx("textarea",{name:"irNotes",value:n.irNotes??"",onChange:o,rows:2,className:"mt-1 w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white",placeholder:"Ex.: nome do prestador, número da nota, vínculo com dependente..."})]})]}),e.jsxs("div",{className:"border rounded-md p-3 bg-gray-50 dark:bg-gray-900/40 space-y-3",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-700 dark:text-gray-200 uppercase",children:"Parcelamento"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 dark:text-gray-300",children:"Número de parcelas"}),e.jsx("input",{type:"number",value:f,onChange:t=>I(Math.max(1,parseInt(t.target.value||"1",10))),className:"mt-1 w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white"})]}),f>1&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 dark:text-gray-300",children:"Data da 1ª parcela"}),e.jsx("input",{type:"date",value:E,onChange:t=>A(t.target.value),className:"mt-1 w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white"})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-2",children:[e.jsx("button",{type:"button",onClick:V,className:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-sm text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-indigo-600 text-white rounded-md text-sm hover:bg-indigo-700",children:"Salvar"})]})]})]})})};export{de as default};
